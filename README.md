# Rogue Orchestra

## Configuration

Create `config.js` locally by copying `config.example.js` and filling in your Supabase credentials. **Do not commit this file.** It should remain private and only exist in your deployment environment.

For local development you can still create `config.js` manually. Copy
`config.example.js` to `config.js` and fill in your own Supabase URL and key.

The HTML files load the Supabase library from jsDelivr using a pinned UMD build
so that the global `supabase` object is always available.

## Running tests

1. Ensure Node.js is installed.
2. From the repository root run:

```bash
npm test
```

This executes a simple Node script that loads `songs.json` and confirms that every `audioFile` listed exists in the `assets/` directory.

## Database setup

The site uses a `votes` table in Supabase to store user votes. It should contain
the following columns:

- `id` – primary key generated by Supabase.
- `song_id` – integer identifier for the song.
- `vote` – text value of either `up` or `down`.

Row level security must permit anonymous `select` and `insert` operations on
this table so visitors can vote without signing in.

### Creating the table and policies

Paste the following commands into the SQL editor of your Supabase project:

```sql
create table if not exists votes (
  id bigserial primary key,
  song_id integer not null,
  vote text not null check(vote in ('up','down')),
  created_at timestamp default now()
);

alter table votes enable row level security;

create policy "Public read" on votes
  for select using (true);

create policy "Public insert" on votes
  for insert with check (true);
```

### Allowing web origins

GitHub Pages will serve `config.js` containing your Supabase credentials. Ensure the root domain (`https://<username>.github.io`) is allowed in your Supabase project's CORS settings if using a paid plan. For free plans, Supabase's default CORS policy should accept requests.
