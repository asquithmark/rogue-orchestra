# Rogue Orchestra

## Configuration

The GitHub Pages workflow automatically generates `config.js` using the
`SUPABASE_URL` and `SUPABASE_KEY` secrets stored in the repository. During
deployment these values are written to `config.js` so the site has access to the
necessary credentials without committing them to source control.

For local development you can still create `config.js` manually. Copy
`config.example.js` to `config.js` and fill in your own Supabase URL and key.

The HTML files load the Supabase library from jsDelivr using a pinned UMD build
so that the global `supabase` object is always available.

## Running tests

1. Ensure Node.js is installed.
2. From the repository root run:

```bash
npm test
```

This executes a simple Node script that loads `songs.json` and confirms that every `audioFile` listed exists in the `assets/` directory.

## Database setup

The site uses a `votes` table in Supabase to store user votes. It should contain
the following columns:

- `id` – primary key generated by Supabase.
- `song_id` – integer identifier for the song.
- `vote` – text value of either `up` or `down`.

Row level security must permit anonymous `select` and `insert` operations on
this table so visitors can vote without signing in.

### Creating the table and policies

Paste the following commands into the SQL editor of your Supabase project:

```sql
create table if not exists votes (
  id bigserial primary key,
  song_id integer not null,
  vote text not null
);

alter table votes enable row level security;

create policy "Public read" on votes
  for select using (true);

create policy "Public insert" on votes
  for insert with check (true);
```

### Allowing web origins

In the Supabase dashboard open **Project Settings → API → CORS** and add the
origins for your site. Include your GitHub Pages domain (e.g.
`https://<username>.github.io`) and `http://localhost:8000` for local
development. This allows anonymous requests from the site to access the `votes`
table.
